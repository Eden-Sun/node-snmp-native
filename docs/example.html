<!DOCTYPE html>  <html> <head>   <title>example.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="example.html">                 example.js               </a>                                           <a class="source" href="asn1ber.html">                 asn1ber.js               </a>                                           <a class="source" href="snmp.html">                 snmp.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               example.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*jslint onevar: true, node: true, continue: false, plusplus: false, bitwise: true, plusplus: true</span>
<span class="cm">  newcap: true, strict: false, maxerr: 50, indent: 4, undef: true, sloppy: true, nomen: true*/</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Example code for node-snmp-native.</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>This file contains examples of how to use the library.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Basic setup</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>The snmp object is the main entry point to the library.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">snmp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;snmp-native&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>We'll use the Underscore library for a few convenience functions.
You should too. We'll also pull in the <code>util</code> library so we can print
out object structures nicely.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">community</span> <span class="o">=</span> <span class="s1">&#39;public&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>A session is required to communicate with an agent.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">snmp</span><span class="p">.</span><span class="nx">Session</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">community</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>All OIDs are represented as integer arrays.
There is no interpretation of string or MIB names.
This here is the OID for sysDescr.0.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">oid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Getting a single value</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>This is how you issue a simple get request.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">oid</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">pkt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">vb</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If there is an error, such as an SNMP timeout, we'll end up here.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>The pkt parameter is a Packet instance, which is closely
modelled after the actual layout of an SNMP packet.
The minimum you need to know is that there is an array of varbinds
that usually contain exactly one entry, in which the 'value'
property holds the reply.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">vb</span> <span class="o">=</span> <span class="nx">pkt</span><span class="p">.</span><span class="nx">pdu</span><span class="p">.</span><span class="nx">varbinds</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;The system description is &quot;&#39;</span> <span class="o">+</span> <span class="nx">vb</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>For reference, this shows how the entire structure looks.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nThe received Packet structure looks like this:&#39;</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">inspect</span><span class="p">(</span><span class="nx">pkt</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>The session must be closed when you're done with it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">session</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Parsing an OID string and getting an entire tree</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>We'll establish a new session since we're doing something independently of the previous requests.
Since it's all asynchronous, it's likely that we haven't received the response and closed the session
above yet, but it might happen later while we're doing other stuff.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">session2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">snmp</span><span class="p">.</span><span class="nx">Session</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">community</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Here we convert an OID from string representation to array.
This is the base OID for the ifName tree.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">oidStr</span> <span class="o">=</span> <span class="s1">&#39;.1.3.6.1.2.1.31.1.1.1.1&#39;</span><span class="p">;</span>
<span class="nx">oid</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">compact</span><span class="p">(</span><span class="nx">oidStr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>You can also get an entire subtree (an SNMP walk).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">session2</span><span class="p">.</span><span class="nx">getSubtree</span><span class="p">(</span><span class="nx">oid</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">pkt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">vb</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The callback will be called once for each entry in the tree.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>If there is an error, such as an SNMP timeout, we'll end up here.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">pkt</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>A null pkt without an error means that we're at the end of tree.
Close the session since we're done.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">session2</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">vb</span> <span class="o">=</span> <span class="nx">pkt</span><span class="p">.</span><span class="nx">pdu</span><span class="p">.</span><span class="nx">varbinds</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Name of interface &#39;</span> <span class="o">+</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">vb</span><span class="p">.</span><span class="nx">oid</span><span class="p">)</span>  <span class="o">+</span> <span class="s1">&#39; is &quot;&#39;</span> <span class="o">+</span> <span class="nx">vb</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Example output</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>The expected output is something along these lines.
Note that the asynchronicity results in a response to the getSubtree
being printed before the system description.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">jb@apto:~/superpoller % node example.js</span>
<span class="cm">Name of interface 1 is &quot;lo0&quot;</span>
<span class="cm">The system description is &quot;Solaris anto.nym.se 11.0 physical&quot;</span>

<span class="cm">The received Packet structure looks like this:</span>
<span class="cm">{ version: 1,</span>
<span class="cm">  community: &#39;public&#39;,</span>
<span class="cm">  pdu: </span>
<span class="cm">   { type: 2,</span>
<span class="cm">     reqid: 1353455559,</span>
<span class="cm">     error: 0,</span>
<span class="cm">     errorIndex: 0,</span>
<span class="cm">     varbinds: </span>
<span class="cm">      [ { type: 4,</span>
<span class="cm">          value: &#39;Solaris anto.nym.se 11.0 physical&#39;,</span>
<span class="cm">          oid: [ 1, 3, 6, 1, 2, 1, 1, 1, 0 ] } ] } }</span>

<span class="cm">Name of interface 2 is &quot;e1000g0&quot;</span>
<span class="cm">Name of interface 3 is &quot;vboxnet0&quot;</span>
<span class="cm">Name of interface 4 is &quot;he0&quot;</span>
<span class="cm">*/</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 